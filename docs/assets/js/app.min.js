(()=>{var t={969:()=>{},379:t=>{"use strict";var e=[];function s(t){for(var s=-1,i=0;i<e.length;i++)if(e[i].identifier===t){s=i;break}return s}function i(t,i){for(var r={},n=[],o=0;o<t.length;o++){var h=t[o],c=i.base?h[0]+i.base:h[0],l=r[c]||0,u="".concat(c," ").concat(l);r[c]=l+1;var d=s(u),p={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var m=a(p,i);i.byIndex=o,e.splice(o,0,{identifier:u,updater:m,references:1})}n.push(u)}return n}function a(t,e){var s=e.domAPI(e);return s.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;s.update(t=e)}else s.remove()}}t.exports=function(t,a){var r=i(t=t||[],a=a||{});return function(t){t=t||[];for(var n=0;n<r.length;n++){var o=s(r[n]);e[o].references--}for(var h=i(t,a),c=0;c<r.length;c++){var l=s(r[c]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}r=h}}},569:t=>{"use strict";var e={};t.exports=function(t,s){var i=function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,s)=>{"use strict";t.exports=function(t){var e=s.nc;e&&t.setAttribute("nonce",e)}},795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(s){!function(t,e,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var a=void 0!==s.layer;a&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,a&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,s),r.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.nc=void 0,(()=>{"use strict";var t=s(379),e=s.n(t),i=s(795),a=s.n(i),r=s(569),n=s.n(r),o=s(565),h=s.n(o),c=s(216),l=s.n(c),u=s(589),d=s.n(u),p=s(969),m=s.n(p),g={};g.styleTagTransform=d(),g.setAttributes=h(),g.insert=n().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=l(),e()(m(),g),m()&&m().locals&&m().locals;class v{constructor(){return this.qs=this.qs,this.qsa=this.qsa,this.ge=this.ge,this.timers=new Map,this.prependZeros=this.prependZeros,this.isStorageAvailable=this.isStorageAvailable,this.getStorageData=this.getStorageData,this.setStorageData=this.setStorageData,this}qs(t,e=document){return e.querySelector(t)}qsa(t=document,e){return t.querySelectorAll(e)}prependZeros(t){return("0"+t).slice(-2)}ge(t,e,s={}){const i=document.createElement(t);switch(Array.isArray(e)?i.classList.add(...e):i.classList.add(e),t){case"input":switch(i.type=s.type??"text",s.name&&(i.name=s.name),s.disabled&&(i.disabled=!0),s.type){case"file":i.multiple=s.multiple??!1,i.accept=s.accept??!1;break;case"text":i.autocomplete=s.autocomplete??!1,i.placeholder=s.placeholder??!1;break;case"checkbox":case"radio":i.checked=s.checked??null}break;case"div":case"span":i.innerText=s.innerText??null;break;case"button":let t=!1;s.innerText&&(t=document.createElement("span")),i.type=s.type??"button",t&&(t.innerText=s.innerText,i.appendChild(t))}return i}isStorageAvailable(){let t;try{t=window.localStorage;let e="__storage_test__";return t.setItem(e,e),t.removeItem(e),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.code||"NS_ERROR_DOM_QUOTA_REACHED"===e.code)&&t&&0!==t.length}}getStorageData(t="timers"){return localStorage.getItem(t)??!1}setStorageData(t,e="timers"){const s=JSON.stringify(t);localStorage.setItem(e,s)}setPageTitle(t){document.title=t}}class b extends v{#t=0;constructor(t,e){if(super(),this.interface=new e,this.timer=t,this.$workArea=this.qs('[data-js="work-area"]'),this.$creatorArea=this.qs('[data-js="creator-area"]',this.$workArea),this.$settingsArea=this.qs('[data-js="settings-area"]',this.$workArea),this.$timersArea=this.qs('[data-js="timers-area"]',this.$workArea),this.$buttonCreate=this.qs('[data-js="create-button"]',this.$creatorArea),this.$buttonExport=this.qs('[data-js="export-button"]',this.$creatorArea),this.$buttonImport=this.qs('[data-js="import-button"]',this.$creatorArea),this.$buttonHistory=this.qs('[data-js="history-button"]',this.$creatorArea),this.$buttonSettings=this.qs('[data-js="settings-button"]',this.$creatorArea),this.$settingAutostop=this.qs('[name="settings-autostop"]',this.$settingsArea),this.$settingStopOnReload=this.qs('[name="settings-stopOnReload"]',this.$settingsArea),this.$settingOnePlay=this.qs('[name="settings-oneplay"]',this.$settingsArea),this.$settingReplaceImport=this.qs('[name="settings-replaceImport"]',this.$settingsArea),this.$settingEnableApi=this.qs('[name="settings-enableApi"]',this.$settingsArea),this.$settingApiUrl=this.qs('[name="settings-apiUrl"]',this.$settingsArea),this.$settingApiKey=this.qs('[name="settings-apiKey"]',this.$settingsArea),this.$titleInput=this.qs('[data-js="title-input"]',this.$creatorArea),this.$uploadInput=this.qs('[data-js="upload-input"]',this.$creatorArea),this._bind()&&(this.intervalWorks=this._intervals(),this.intervalWorks&&this.isStorageAvailable())){const t=JSON.parse(this.getStorageData());t.length>0&&this.generateTimersFromBackup(t);const e=JSON.parse(this.getStorageData("settings"));this.restoreSettingsFromBackup(e)}}_bind(){const t=this;let e=!0;return this.$buttonCreate?this.$buttonCreate.addEventListener("click",this.createTimer.bind(this)):e=!1,this.$buttonExport?this.$buttonExport.addEventListener("click",this.exportTimers.bind(this)):e=!1,this.$buttonImport?this.$buttonImport.addEventListener("click",this.buttonImportHandler.bind(this)):e=!1,this.$uploadInput?this.$uploadInput.addEventListener("change",this.importTimers.bind(this)):e=!1,this.$buttonHistory?this.$buttonHistory.addEventListener("click",this.showHistory.bind(this)):e=!1,this.$buttonSettings?this.$buttonSettings.addEventListener("click",this.showSettings.bind(this)):e=!1,this.$titleInput?this.$titleInput.addEventListener("keypress",(e=>{e.target.value.length&&"Enter"===e.key&&t.createTimer()})):e=!1,e}_intervals(){return setInterval(this.updateActions.bind(this),500)}createTimer(){const t=new this.timer(this.$titleInput.value),e=this.interface.generateTimer(this.#t,{timerTitle:this.$titleInput.value});if(this.timers.set(this.#t,{ui:e,controls:t}),this.$timersArea.appendChild(e.area),e.playpause.addEventListener("click",this.timerStartStop.bind(this,t,e,this.#t)),e.remove.addEventListener("click",this.timerRemove.bind(this,this.#t,e)),e.restart.addEventListener("click",this.timerRestart.bind(this,t,e)),e.title.addEventListener("keyup",this.timerChangeTitle.bind(this,t,e)),e.getTask.addEventListener("click",this.timerGetTaskName.bind(this,t,e)),this.$settingAutostop.checked)for(const t of this.timers.keys()){const e=this.timers.get(t);e.controls.isPaused||(e.controls.pause(),e.ui.playpause.classList.add("timer__button_playpause-paused"))}this.$titleInput.value="",this.#t++}exportTimers(){const t=this.createTimersBackup(!0);if(t.length>0){const e=JSON.stringify(t),s="data:application/json;charset=utf-8,"+encodeURIComponent(e),i=new Date;let a="data_timers.json",r=i.getFullYear(),n=i.getMonth()+1,o=i.getDate();n=this.prependZeros(n),o=this.prependZeros(o),a=`${o}.${n}.${r}-${a}`;const h=document.createElement("a");h.setAttribute("href",s),h.setAttribute("download",a),h.click(),h.remove()}}buttonImportHandler(){this.$uploadInput&&this.$uploadInput.click()}importTimers(t){const e=t.target,s=this;if(1===e.files.length){const t=e.files[0],i=new FileReader;i.readAsText(t),i.onload=function(){const t=JSON.parse(i.result);t.length>0&&s.generateTimersFromBackup(t)},e.value=""}}showHistory(){}showSettings(){this.$settingsArea.classList.toggle("settings-active")}updateActions(){this.updateTimers(),this.updateStorage(),this.updatePageTitles()}updateTimers(){for(const t of this.timers.keys()){const e=this.timers.get(t),s=e.controls.getTime;s&&(e.ui.result.innerText=s)}}updateStorage(){this.createTimersBackup(),this.createSettingsBackup()}timerStartStop(t,e,s){if(t.playPause(),this.$settingOnePlay.checked&&!t.isPaused)for(const t of this.timers.keys()){const e=this.timers.get(t);e.controls.isPaused||t==s||(e.controls.pause(),e.ui.playpause.classList.add("timer__button_playpause-paused"))}t.isPaused?e.playpause.classList.add("timer__button_playpause-paused"):e.playpause.classList.remove("timer__button_playpause-paused")}timerRemove(t,e){confirm("Вы уверены, что хотите удалить таймер?")&&(e.area.remove(),this.timers.delete(t))}timerRestart(t,e){confirm("Вы уверены, что хотите перезапустить таймер? Все данные будут потеряны.")&&(t.restart(),e.playpause.classList.contains(".timer__button_playpause-paused")||e.playpause.classList.add("timer__button_playpause-paused"),e.result.innerText="00:00:00 — 0.00")}timerChangeTitle(t,e,s){const i=s.target.value.trim();i.length>0&&(t.title=i)}timerGetTaskName(t,e,s){const i=t.getTitle,a=new RegExp("https\\:\\/\\/[a-z]+\\.[a-z]+\\.ru\\/task\\/([0-9]+)","gm");let r;for(;null!==(r=a.exec(i));)this.$settingEnableApi.checked&&r[1]&&fetch(`${this.$settingApiUrl.value}rest/task/${r[1]}/?fields=id,name&access_token=${this.$settingApiKey.value}`,{method:"get"}).then((t=>!!t.ok&&t.json())).then((s=>{s&&"success"===s.result&&(console.log(s.task),t.title=`${s.task.name} (${this.$settingApiUrl.value}task/${s.task.id})`,e.title.value=`${s.task.name} (${this.$settingApiUrl.value}task/${s.task.id})`)}))}createTimersBackup(t=!1){if(this.isStorageAvailable()){const e=[];for(const t of this.timers.keys()){const s=this.timers.get(t),i={duration:s.controls.durationSeconds,title:s.controls.timerData.title};e.push(i)}return t?e:(this.setStorageData(e),!0)}return!1}createSettingsBackup(t=!1){const e={autostop:this.$settingAutostop.checked,onePlay:this.$settingOnePlay.checked,enableApi:this.$settingEnableApi.checked,apiUrl:this.$settingApiUrl.value,apiKey:this.$settingApiKey.value};this.setStorageData(e,"settings")}generateTimersFromBackup(t){try{t.forEach((t=>{const e=new this.timer(t.title,t.duration),s=this.interface.generateTimer(this.#t,{timerTitle:t.title});this.timers.set(this.#t,{ui:s,controls:e}),this.$timersArea.appendChild(s.area),s.playpause.addEventListener("click",this.timerStartStop.bind(this,e,s,this.#t)),s.remove.addEventListener("click",this.timerRemove.bind(this,this.#t,s)),s.restart.addEventListener("click",this.timerRestart.bind(this,e,s)),s.title.addEventListener("keyup",this.timerChangeTitle.bind(this,e,s)),s.getTask.addEventListener("click",this.timerGetTaskName.bind(this,e,s));const i=e.timeForReload.length>18?"00:00:00 — 0.00":e.timeForReload;s.result.innerText=i,this.#t++}))}catch(t){throw new Error(t)}}restoreSettingsFromBackup(t){t.autostop&&(this.$settingAutostop.checked=!0),t.stopOnReload&&(this.$settingStopOnReload.checked=!0),t.onePlay&&(this.$settingOnePlay.checked=!0),t.replaceImport&&(this.$settingReplaceImport.checked=!0),t.enableApi&&(this.$settingEnableApi.checked=!0),t.apiUrl&&(this.$settingApiUrl.value=t.apiUrl),t.apiKey&&(this.$settingApiKey.value=t.apiKey)}updatePageTitles(){const t=[];for(const e of this.timers.keys()){const s=this.timers.get(e);s.controls.isPaused||t.push(s.controls.getTitle)}t.length>1?this.setPageTitle(`[▶] Запущенные задачи: ${t.length}`):1===t.length?this.setPageTitle(`[▶] ${t[0]}`):this.setPageTitle("Work Timers")}}class $ extends v{#e=!1;#s=!1;#i=0;#a=void 0;#r=void 0;constructor(t,e){if(super(),e){const t=Date.now();this.#e=!0,this.#a=t,this.#s=t-e}this.#r=t.length?t:"Задача без названия"}getTimeString(t){t=Math.floor(t/1e3);let e=Math.floor(t/3600);t%=3600;let s=Math.floor(t/60),i=(e+s/60).toFixed(2),a=t%60;return e=this.prependZeros(e),s=this.prependZeros(s),a=this.prependZeros(a),`${e}:${s}:${a} — ${i}`}get durationSeconds(){const t=Date.now();return this.#e&&!this.#a?t-this.#s-this.#i:this.#e?t-this.#s-(t-this.#a+this.#i):0}get getTime(){return!(!this.#e||this.#a)&&this.getTimeString(Date.now()-this.#s-this.#i)}get getTitle(){return this.#r}get timeForReload(){return this.getTimeString(Date.now()-this.#s-this.#i)}get isPaused(){return!(!this.#a&&this.#e)}get timerData(){return{activated:this.#e,started:this.#s,paused:this.#i,pauseStarted:this.#a,title:this.#r}}set title(t){this.#r=t}pause(){const t=Date.now();this.#e&&!this.#a&&(this.#a=t)}playPause(){const t=Date.now();this.#e?this.#a?(this.#i+=t-this.#a,this.#a=void 0):this.#a=t:(this.#e=!0,this.#s=t)}restart(){this.#e=!1,this.#s=!1,this.#i=0,this.#a=void 0}}class f extends v{constructor(){super()}generateTimer(t,e){const s=this.ge("div","timer"),i=this.ge("input","timer__title-input"),a=this.ge("div","timer__result",{innerText:"00:00:00 — 0.00"}),r=this.ge("div",["timer__button","timer__button_playpause","timer__button_playpause-paused"]),n=this.ge("div",["timer__button","timer__button_remove"]),o=this.ge("div",["timer__button","timer__button_restart"]),h=this.ge("div",["timer__button","timer__button_get-task"]);return[i,r,h,a,o,n].forEach((t=>s.appendChild(t))),i.value=e.timerTitle.trim().length?e.timerTitle:"Задача без названия",s.dataset.jsTimerId=t,{area:s,title:i,getTask:h,result:a,playpause:r,restart:o,remove:n}}}document.addEventListener("DOMContentLoaded",(()=>{new b($,f)}))})()})();
//# sourceMappingURL=app.min.js.map